# Тестування на Підвищення Привілеїв

## Резюме
У цьому розділі описано проблему підвищення привілеїв від одного етапу до іншого. Під час цього етапу тестувальник повинен переконатися, що користувач не може змінити свої привілеї або ролі в програмі таким чином, щоб це дозволило атаки на підвищення привілеїв.

Підвищення привілеїв відбувається, коли користувач отримує доступ до більшої кількості ресурсів або функціональних можливостей, ніж зазвичай дозволено, і такому підвищенню чи змінам програма повинна була запобігти. Зазвичай це спричинено недоліком програми. Результатом є те, що програма виконує дії з більшими привілеями, ніж ті, які передбачав розробник або системний адміністратор.

Ступінь ескалації залежить від того, якими привілеями має право володіти зловмисник і які привілеї можна отримати в результаті успішного використання. Наприклад, помилка програмування, яка дозволяє користувачеві отримати додатковий привілей після успішної автентифікації, обмежує ступінь ескалації, оскільки користувач уже має право мати певні привілеї. Подібним чином віддалений зловмисник, який отримує привілеї суперкористувача без будь-якої автентифікації, представляє більший ступінь ескалації.

Зазвичай люди називають вертикальну ескалацію, коли є можливість отримати доступ до ресурсів, наданих більш привілейованим обліковим записам (наприклад, отримання прав адміністратора для програми), і горизонтальну ескалацію, коли можна отримати доступ до ресурсів, наданих подібно налаштованому обліковому запису (наприклад, у програмі онлайн-банкінгу, доступ до інформації, пов’язаної з іншим користувачем).

## Цілі Тесту
* Визначте точки ін’єкції, пов’язані з маніпулюванням привілеями.
* Фуз або іншим чином намагатися обійти заходи безпеки.

## Як Тестувати
### Тестування на маніпуляції ролями/привілеями
У кожній частині програми, де користувач може створити інформацію в базі даних (наприклад, здійснити платіж, додати контакт або надіслати повідомлення), отримати інформацію (виписку з рахунку, деталі замовлення тощо) або видалити інформацію (видалення користувачів, повідомлень тощо), необхідно записати цю функцію. Тестер повинен спробувати отримати доступ до таких функцій як інший користувач, щоб перевірити, чи можливий доступ до функції, яка не повинна бути дозволена роллю/привілеєм користувача (але може бути дозволена як інший користувач).

## Маніпуляції Групою Користувачів
Наприклад: наступний HTTP POST дозволяє користувачеві, який належить до grp001, отримати доступ до замовлення №0001:

> POST /user/viewOrder.jsp HTTP/1.1 </br>
> Host: www.example.com </br>
> ... </br>
> groupID=grp001&orderID=0001 </br>

Перевірте, чи може користувач, який не належить до grp001, змінити значення параметрів groupID і orderID, щоб отримати доступ до цих привілейованих даних.

## Маніпуляції з Профілем Користувача
Наприклад: наступна відповідь сервера показує приховане поле в HTML, яке повертається користувачеві після успішної автентифікації.

> HTTP/1.1 200 OK </br>
> Server: Netscape-Enterprise/6.0 </br>
> Date: Wed, 1 Apr 2006 13:51:20 GMT </br>
> Set-Cookie: USER=aW78ryrGrTWs4MnOd32Fs51yDqp; path=/; domain=www.example.com </br>
> Set-Cookie: SESSION=k+KmKeHXTgDi1J5fT7Zz; path=/; domain= www.example.com </br>
> Cache-Control: no-cache </br>
> Pragma: No-cache </br>
> Content-length: 247 </br>
> Content-Type: text/html </br>
> Expires: Thu, 01 Jan 1970 00:00:00 GMT </br>
> Connection: close </br>
>  </br>
> \<form  name="autoriz" method="POST" action = "visual.jsp"> </br>
> \<input type="hidden" name="profile" value="SysAdmin">\ </br>
>  </br>
> \<body onload="document.forms.autoriz.submit()"> </br>
> \</td> </br>
> \</tr> </br>


Що робити, якщо тестер змінить значення профілю змінної на SysAdmin? Чи можна стати **адміністратором**?

## Маніпулювання значенням умови
Наприклад: у середовищі, де сервер надсилає повідомлення про помилку, що міститься як значення певного параметра в наборі кодів відповіді, як показано нижче:

> @0\`1\`3\`3\`\`0\`UC\`1\`Status\`OK\`SEC\`5\`1\`0\`ResultSet\`0\`PVValid\`-1\`0\`0\` Сповіщення\`0\`0\`3\`Команда Менеджер\`0\`0\`0\` StateToolsBar\`0\`0\`0\` </br>
> StateExecToolBar\`0\`0\`0\`FlagsToolBar\`0 </br>

Сервер надає неявну довіру користувачеві. Вважається, що користувач відповість наведеним вище повідомленням, закриваючи сеанс.

У цьому випадку переконайтеся, що неможливо підвищити привілеї шляхом зміни значень параметрів. У цьому конкретному прикладі, змінивши значення PVValid з -1 на 0 (умови помилки відсутні), можна автентифікуватися як адміністратор сервера.

## Маніпуляції з IP-адресою
Деякі веб-сайти обмежують доступ або підраховують кількість невдалих спроб входу на основі IP-адреси.

Наприклад:

> X-Forwarded-For: 8.1.1.1

У цьому випадку, якщо веб-сайт використовує значення X-forwarded-For як IP-адресу клієнта, тестер може змінити значення IP у HTTP-заголовку X-forwarded-For, щоб обійти ідентифікацію джерела IP.

## Обхід URL-адреси
Спробуйте пройти веб-сайт і перевірити, чи деякі сторінки, які можуть пропустити перевірку авторизації.

Наприклад:

> /../.././userInfo.html

## Біла коробка
Якщо перевірка авторизації URL-адреси виконується лише за частковим збігом URL-адреси, імовірно, тестувальники або хакери можуть обійти авторизацію за допомогою методів кодування URL-адреси.

Наприклад:

> startswith(), endswith(), contains(), indexOf()

## Слабкий ідентифікатор сеансу
Слабкий ідентифікатор сеансу має алгоритм, який може бути вразливим до грубої атаки. Наприклад, один веб-сайт використовує MD5 (пароль + ідентифікатор користувача) як ідентифікатор сесії. Тоді тестувальники можуть вгадати або згенерувати ідентифікатор сесії для інших користувачів.
